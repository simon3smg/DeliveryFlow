<!DOCTYPE html>
<html lang="en" class="dark" style="background-color: #020617;">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
    <meta name="theme-color" content="#020617" />
    <title>DeliveryFlow</title>
    
    <!-- ERROR TRAP: Displays startup errors on screen -->
    <script>
      window.addEventListener('error', function(event) {
        const root = document.getElementById('root');
        if (root) {
          // Only show if root is still empty/loading
          if (root.innerText.includes('Loading')) {
             root.innerHTML = `
                <div style="color: #f87171; background-color: #020617; min-height: 100vh; padding: 40px; font-family: system-ui; text-align: center;">
                <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; color: #f8fafc;">Application Error</h2>
                <p style="background: #1e293b; color: #fca5a5; padding: 20px; border-radius: 12px; display: inline-block; font-family: monospace; font-size: 0.9rem; border: 1px solid #334155; max-width: 100%; overflow-x: auto;">${event.message}</p>
                <p style="font-size: 0.9rem; color: #94a3b8; margin-top: 20px;">Check console for details.</p>
                </div>
            `;
          }
        }
      });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            padding: {
              'safe': 'env(safe-area-inset-bottom)'
            }
          }
        }
      }
    </script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Leaflet Map JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <style>
      :root {
        color-scheme: dark; /* Forces native controls (date picker, select) to dark mode */
      }

      html, body {
        font-family: 'Inter', sans-serif;
        background-color: #020617 !important; /* Slate 950 - Dark default */
        color: #f8fafc;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }

      /* Dark Mode Map Inversion - Enforced Globally */
      .leaflet-tile-pane {
        filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
      }
      .leaflet-container {
        background: #0f172a; /* Slate 900 */
      }

      /* Dark Mode Leaflet Popups */
      .leaflet-popup-content-wrapper,
      .leaflet-popup-tip {
        background-color: #0f172a; /* slate-900 */
        color: #f8fafc;
        border: 1px solid #1e293b; /* slate-800 */
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
      }
      .leaflet-popup-content {
        color: #cbd5e1; /* slate-300 */
      }
      
      /* Dark Mode Leaflet Controls */
      .leaflet-bar a {
        background-color: #1e293b; /* slate-800 */
        color: #f8fafc;
        border-bottom: 1px solid #334155; /* slate-700 */
      }
      .leaflet-bar a:hover {
        background-color: #334155; /* slate-700 */
      }
      .leaflet-bar a.leaflet-disabled {
        background-color: #1e293b;
        color: #64748b;
      }
      .leaflet-control-attribution {
        background-color: rgba(15, 23, 42, 0.7) !important;
        color: #94a3b8 !important;
      }
      .leaflet-control-attribution a {
        color: #818cf8 !important; /* indigo-400 */
      }

      /* Autofill Fix for Dark Mode */
      input:-webkit-autofill,
      input:-webkit-autofill:hover, 
      input:-webkit-autofill:focus, 
      input:-webkit-autofill:active{
          -webkit-background-clip: text;
          -webkit-text-fill-color: #f8fafc;
          transition: background-color 5000s ease-in-out 0s;
          box-shadow: inset 0 0 20px 20px #1e293b; /* Match slate-800 */
      }
      
      @media print {
        .no-print { display: none !important; }
        .print-only { display: block !important; }
        .break-before-page { page-break-before: always; }
        /* Reset Leaflet filters for print */
        .leaflet-tile-pane {
            filter: none !important;
        }
      }
      .leaflet-default-icon-path {
        background-image: url(https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png);
      }

      /* Mobile Optimizations */
      @media screen and (max-width: 768px) {
        input, select, textarea {
          font-size: 16px !important; /* Prevent iOS zoom */
        }
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@19.2.1",
    "react-dom/client": "https://aistudiocdn.com/react-dom@19.2.1/client",
    "react-dom": "https://aistudiocdn.com/react-dom@19.2.1",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^6.22.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
    "firebase/analytics": "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js",
    "react-dom/": "https://aistudiocdn.com/react-dom@19.2.1/",
    "react/": "https://aistudiocdn.com/react@19.2.1/",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/"
  }
}
</script>
</head>
  <body class="bg-slate-950 text-slate-100 antialiased overflow-hidden">
    <div id="root" class="flex h-screen w-full items-center justify-center bg-slate-950 text-indigo-400">
        <!-- Initial Loader -->
        <div class="flex flex-col items-center gap-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-400"></div>
            <p class="font-medium animate-pulse">Loading DeliveryFlow...</p>
        </div>
    </div>
  </body>
</html>